{"version":3,"file":"EmbeddingPulseUrl.js","sourceRoot":"","sources":["../../../../src/EmbeddingApi/Models/EmbeddingPulseUrl.ts"],"names":[],"mappings":";;AAAA,gFAAwG;AACxG,gFAAgG;AAChG,0DAAkE;AAClE,+DAAwF;AAExF,SAAgB,cAAc,CAAC,GAAW,EAAE,OAAsB,EAAE,YAA+B;IACjG,0GAA0G;IAC1G,MAAM,qBAAqB,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IAEhD,IAAI,GAAQ,CAAC;IACb,IAAI;QACF,GAAG,GAAG,IAAI,GAAG,CAAC,qBAAqB,CAAC,CAAC;QACrC,iCAAW,CAAC,GAAG,CAAC,CAAC;KAClB;IAAC,OAAO,KAAK,EAAE;QACd,MAAM,IAAI,4BAAY,CAAC,8CAAmB,CAAC,UAAU,EAAG,KAAe,CAAC,OAAO,CAAC,CAAC;KAClF;IACD,MAAM,aAAa,GAAG,4BAA4B,CAAC,GAAG,CAAC,CAAC;IACxD,MAAM,OAAO,GAAG,IAAI,wBAAwB,CAAC,GAAG,CAAC;SAC9C,uBAAuB,CAAC,aAAa,CAAC;SACtC,iBAAiB,CAAC,OAAO,CAAC;SAC1B,kBAAkB,CAAC,YAAY,CAAC,CAAC;IAEpC,OAAO,OAAO,CAAC,KAAK,EAAE,CAAC;AACzB,CAAC;AAlBD,wCAkBC;AAED,SAAS,4BAA4B,CAAC,GAAQ;IAC5C,MAAM,iBAAiB,GAAkB,IAAI,GAAG,EAAE,CAAC;IACnD,MAAM,eAAe,GAAG,GAAG,oDAAyB,CAAC,KAAK,IAAI,oDAAyB,CAAC,KAAK,IAAI,oDAAyB,CAAC,GAAG,EAAE,CAAC;IACjI,iBAAiB,CAAC,GAAG,CAAC,2CAAgB,CAAC,kBAAkB,EAAE,eAAe,CAAC,CAAC;IAC5E,iBAAiB,CAAC,GAAG,CAAC,2CAAgB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;IACnD,MAAM,eAAe,GAAG,0BAAU,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,yBAAyB;IACrF,iBAAiB,CAAC,GAAG,CAAC,2CAAgB,CAAC,kBAAkB,EAAE,eAAe,CAAC,CAAC;IAC5E,iBAAiB,CAAC,GAAG,CAAC,2CAAgB,CAAC,iBAAiB,EAAE,MAAM,CAAC,CAAC;IAElE,OAAO,iBAAiB,CAAC;AAC3B,CAAC;AAED,MAAa,wBAAyB,SAAQ,yCAAmB;IAC/D,YAAmB,IAAS;QAC1B,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,YAAY,GAAG,2CAAgB,CAAC;IACvC,CAAC;IAED;;;;OAIG;IACO,sBAAsB,CAAC,aAAqB,EAAE,KAAc;QACpE,OAAO,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;IACnC,CAAC;CACF;AAfD,4DAeC","sourcesContent":["import { CustomParameter, EmbeddingErrorCodes, PulseSettings } from '@tableau/api-external-contract-js';\nimport { INTERNAL_CONTRACT_VERSION, PulseOptionNames } from '@tableau/api-internal-contract-js';\nimport { ApiVersion, TableauError } from '@tableau/api-shared-js';\nimport { EmbeddingUrlBuilder, ParametersMap, validateUrl } from './EmbeddingUrlBuilder';\n\nexport function createPulseUrl(src: string, options: PulseSettings, customParams: CustomParameter[]) {\n  // strip params in URL, all custom params should come through 'pulseOptions', 'filters' or 'customParams'.\n  const srcWithoutQueryParams = src.split('?')[0];\n\n  let url: URL;\n  try {\n    url = new URL(srcWithoutQueryParams);\n    validateUrl(url);\n  } catch (error) {\n    throw new TableauError(EmbeddingErrorCodes.InvalidUrl, (error as Error).message);\n  }\n  const defaultParams = createPulseDefaultParameters(url);\n  const builder = new EmbeddingPulseUrlBuilder(url)\n    .appendDefaultParameters(defaultParams)\n    .appendUserOptions(options)\n    .appendCustomParams(customParams);\n\n  return builder.build();\n}\n\nfunction createPulseDefaultParameters(url: URL): ParametersMap {\n  const defaultParameters: ParametersMap = new Map();\n  const internalVersion = `${INTERNAL_CONTRACT_VERSION.major}.${INTERNAL_CONTRACT_VERSION.minor}.${INTERNAL_CONTRACT_VERSION.fix}`;\n  defaultParameters.set(PulseOptionNames.ApiInternalVersion, internalVersion);\n  defaultParameters.set(PulseOptionNames.embed, 'y');\n  const externalVersion = ApiVersion.Instance.formattedValue; // maj.min.fix (no build)\n  defaultParameters.set(PulseOptionNames.ApiExternalVersion, externalVersion);\n  defaultParameters.set(PulseOptionNames.PulseWebComponent, 'true');\n\n  return defaultParameters;\n}\n\nexport class EmbeddingPulseUrlBuilder extends EmbeddingUrlBuilder {\n  public constructor(_url: URL) {\n    super();\n    this._url = _url;\n    this._optionNames = PulseOptionNames;\n  }\n\n  /**\n   * Sanitizes parameter values before they are added to the search params.\n   * @param parameterName The name of the parameter. Some parameters require special handling.\n   * @param value The raw value of the parameter.\n   */\n  protected sanitizeParameterValue(parameterName: string, value: unknown): string {\n    return this.sanitizeValue(value);\n  }\n}\n"]}