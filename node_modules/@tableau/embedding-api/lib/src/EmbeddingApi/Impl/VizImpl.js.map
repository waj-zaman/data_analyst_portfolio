{"version":3,"file":"VizImpl.js","sourceRoot":"","sources":["../../../../src/EmbeddingApi/Impl/VizImpl.ts"],"names":[],"mappings":"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","sourcesContent":["import * as Contract from '@tableau/api-external-contract-js';\nimport { TableauDialogType } from '@tableau/api-external-contract-js/lib/src/ExternalContract/Embedding/Enums';\nimport {\n  CrossFrameMessenger,\n  CustomViewInfoModel,\n  EmbeddingBootstrapInfo,\n  FirstVizSizeKnownEvent as FirstVizSizeKnownModel,\n  INTERNAL_CONTRACT_VERSION,\n  InternalApiDispatcher,\n  NotificationId,\n  ToolbarStateEvent,\n  VersionEqualTo,\n  VersionLessThan,\n  VersionNumber,\n  VisualId,\n} from '@tableau/api-internal-contract-js';\nimport {\n  ApiServiceRegistry,\n  CrossFrameDispatcher,\n  CustomViewImpl,\n  DashboardImpl,\n  DataSourceService,\n  ExportHelpers,\n  ExportService,\n  NotificationService,\n  ServiceNames,\n  SheetUtils,\n  StoryImpl,\n  TableauError,\n  VizService,\n  WorksheetImpl,\n  registerAllSharedServices,\n} from '@tableau/api-shared-js';\nimport { TableauVizBase } from '../Components/TableauVizBase';\nimport { getLocalizedTitle } from '../Components/TableauWebComponent';\nimport { FirstVizSizeKnownEvent } from '../Events/FirstVizSizeKnownEvent';\nimport { TabSwitchedEvent } from '../Events/TabSwitchedEvent';\nimport { ToolbarStateChangedEvent } from '../Events/ToolbarStateChangedEvent';\nimport { EmbeddingWorkbookImpl } from '../Impl/EmbeddingWorkbookImpl';\nimport { CustomView } from '../Models/CustomView';\nimport { VizSize } from '../Models/VizSize';\nimport { EmbeddingServiceNames, ToolbarService, registerAllEmbeddingServices, registerInitializationEmbeddingServices } from '../Services';\nimport { AuthService } from '../Services/AuthService';\nimport { registerAuthServices } from '../Services/RegisterAllEmbeddingServices';\nimport { HtmlElementHelpers } from '../Utils/HtmlElementHelpers';\n\nexport class VizImpl {\n  private _workbookImpl: EmbeddingWorkbookImpl;\n  private _vizSize: VizSize;\n  private _automaticUpdatesArePaused = false;\n  private _dispatcher: InternalApiDispatcher;\n  private _messenger: CrossFrameMessenger;\n  private readonly _resizeEventType = 'resize';\n  private _windowResizeHandler?: () => void;\n\n  // Used to store the custom view when the custom view event is fired before the interactive event\n  private _customViewsTemp: CustomViewInfoModel | null;\n\n  public constructor(\n    private _viz: TableauVizBase,\n    private _iframe: HTMLIFrameElement,\n    private _frameUrl: URL,\n    private _embeddingId: number,\n  ) {\n    if (!this._iframe) {\n      throw new TableauError(Contract.EmbeddingErrorCodes.InternalError, 'Iframe has not been created yet');\n    }\n  }\n\n  public get workbookImpl(): EmbeddingWorkbookImpl {\n    return this._workbookImpl;\n  }\n\n  public get iframe(): HTMLIFrameElement {\n    return this._iframe;\n  }\n\n  public get embeddingId(): number {\n    return this._embeddingId;\n  }\n\n  private get exportScenariosForPdfAndPowerPoint(): Contract.ExportScenariosForPDFAndPowerPoint {\n    return {\n      currentSheetName: this._workbookImpl.activeSheet.name,\n      exportableSheetNamesFromDashboard: this.exportableSheetNamesFromDashboard,\n      exportableSheetNamesFromWorkbook: this.exportableSheetNamesFromWorkbook,\n    };\n  }\n\n  private get exportableSheetNamesFromDashboard(): Array<string> {\n    const currentSheet = this._workbookImpl.activeSheet as DashboardImpl;\n    if (currentSheet && currentSheet.sheetType === Contract.SheetType.Dashboard) {\n      return currentSheet.getWorksheetNamesFromZones();\n    }\n    return [];\n  }\n\n  private get exportableSheetNamesFromWorkbook(): Array<string> {\n    const exportableSheetNames: Array<string> = [];\n    if (this._workbookImpl) {\n      for (const publishedSheetInfo of this._workbookImpl.publishedSheetsInfo) {\n        exportableSheetNames.push(publishedSheetInfo.name);\n      }\n    }\n    return exportableSheetNames;\n  }\n\n  public get automaticUpdatesArePaused(): boolean {\n    return this._automaticUpdatesArePaused;\n  }\n\n  // TODO: TFS 892510 TabSwitchEvent etc is resposible for updating the state\n  public set automaticUpdatesArePaused(isAutoUpdate: boolean) {\n    this._automaticUpdatesArePaused = isAutoUpdate;\n  }\n\n  private getVisualIdForSheetName(sheetName: string): VisualId {\n    const currentSheet = this._workbookImpl.activeSheet;\n    switch (currentSheet.sheetType) {\n      case Contract.SheetType.Worksheet:\n        if (currentSheet.name === sheetName) {\n          return (currentSheet as WorksheetImpl).visualId;\n        }\n        break;\n      case Contract.SheetType.Dashboard: {\n        const dashboardImpl = currentSheet as DashboardImpl;\n        for (const worksheetName of dashboardImpl.getWorksheetNamesFromZones()) {\n          if (worksheetName === sheetName) {\n            return { worksheet: worksheetName, dashboard: dashboardImpl.name };\n          }\n        }\n        break;\n      }\n      case Contract.SheetType.Story: {\n        const storyImpl = currentSheet as StoryImpl;\n        const containedSheet = storyImpl.activeStoryPoint?.containedSheet;\n        if (containedSheet && containedSheet.sheetType === Contract.SheetType.Worksheet && containedSheet.name === sheetName) {\n          // TFSID 1505602: VisualId is incomplete for worksheets within stories\n          const visualId = { ...(containedSheet as WorksheetImpl).visualId };\n          visualId.dashboard = visualId.worksheet;\n          visualId.storyboard = storyImpl.name;\n          visualId.storyPointID = storyImpl.activeStoryPoint?.storyPointId;\n          return visualId;\n        } else if (containedSheet && containedSheet.sheetType === Contract.SheetType.Dashboard) {\n          const dashboard = containedSheet as DashboardImpl;\n          // @W-12986439: use worksheetImpls here, but the VisualIds are still incomplete for worksheets within dashboards within stories (TFSID 1505602)\n          for (const worksheetName of dashboard.getWorksheetNamesFromZones()) {\n            if (worksheetName === sheetName) {\n              return {\n                worksheet: worksheetName,\n                dashboard: dashboard.name,\n                storyboard: storyImpl.name,\n                storyPointID: storyImpl.activeStoryPoint?.storyPointId,\n              };\n            }\n          }\n        }\n        break;\n      }\n      default:\n        throw new TableauError(Contract.SharedErrorCodes.ServerError, 'Invalid SheetType');\n    }\n    throw new TableauError(\n      Contract.SharedErrorCodes.InvalidParameter,\n      'sheetName parameter must belong to a worksheet within the current view',\n    );\n  }\n\n  private get exportableWorksheetNames(): Array<string> {\n    const currentSheet = this._workbookImpl.activeSheet;\n    switch (currentSheet.sheetType) {\n      case Contract.SheetType.Worksheet:\n        return [currentSheet.name];\n      case Contract.SheetType.Dashboard:\n        return (currentSheet as DashboardImpl).getWorksheetNamesFromZones();\n      case Contract.SheetType.Story: {\n        const containedSheet = (currentSheet as StoryImpl).activeStoryPoint?.containedSheet;\n        if (containedSheet && containedSheet.sheetType === Contract.SheetType.Worksheet) {\n          return [containedSheet.name];\n        } else if (containedSheet && containedSheet.sheetType === Contract.SheetType.Dashboard) {\n          return (containedSheet as DashboardImpl).getWorksheetNamesFromZones();\n        }\n        break;\n      }\n      default:\n        break;\n    }\n    return [];\n  }\n\n  public initializeViz(): void {\n    const iframeWindow = this._iframe.contentWindow;\n    if (!iframeWindow) {\n      throw new TableauError(Contract.EmbeddingErrorCodes.InternalError, 'Iframe has not been created yet');\n    }\n    try {\n      this._messenger = new CrossFrameMessenger(window, iframeWindow, this._frameUrl.origin);\n\n      // We need the notification service for the bootstrap flow.\n      this._dispatcher = new CrossFrameDispatcher(this._messenger);\n      registerInitializationEmbeddingServices(this._dispatcher, this.embeddingId);\n      registerAuthServices(this._dispatcher, this.embeddingId);\n\n      const initializationService = ApiServiceRegistry.get(this.embeddingId).getService<NotificationService>(ServiceNames.Initialization);\n      const vizSizeKnownUnregister = initializationService.registerHandler(\n        NotificationId.FirstVizSizeKnown,\n        () => true,\n        (model: FirstVizSizeKnownModel) => {\n          this.handleVizSizeKnownEvent(model);\n          vizSizeKnownUnregister();\n        },\n      );\n      const vizInteractiveUnregister = initializationService.registerHandler(\n        NotificationId.VizInteractive,\n        () => true,\n        (model: EmbeddingBootstrapInfo) => {\n          this.handleVizInteractiveEvent(model);\n          vizInteractiveUnregister();\n        },\n      );\n      initializationService.registerHandler(\n        NotificationId.ReadyToReceiveAuthToken,\n        () => true,\n        () => {\n          this._viz.dispatchEvent(new CustomEvent(Contract.EmbeddingTableauEventType.ReadyToReceiveAuthToken, {}));\n        },\n      );\n      initializationService.registerHandler(\n        NotificationId.ToolbarStateChanged,\n        () => true,\n        (model: ToolbarStateEvent) => this.handleToolbarStateEvent(model),\n      );\n      initializationService.registerHandler(\n        NotificationId.TabSwitched,\n        () => true,\n        (model: EmbeddingBootstrapInfo) => this.handleTabSwitch(model),\n      );\n      initializationService.registerHandler(\n        NotificationId.CustomViewsLoaded,\n        () => true,\n        (model: CustomViewInfoModel) => this.handleCustomViews(model),\n      );\n      initializationService.registerHandler(\n        NotificationId.CustomViewRemoved,\n        () => true,\n        (model: CustomViewInfoModel) => this.handleCustomViewRemoved(model),\n      );\n      initializationService.registerHandler(\n        NotificationId.CustomViewSaved,\n        () => true,\n        (model: CustomViewInfoModel) => this.handleCustomViewSaved(model),\n      );\n      initializationService.registerHandler(\n        NotificationId.CustomViewSetDefault,\n        () => true,\n        (model: CustomViewInfoModel) => this.handleCustomViewSetDefault(model),\n      );\n      this._messenger.startListening();\n    } catch (e) {\n      throw new TableauError(Contract.EmbeddingErrorCodes.InternalError, 'Unexpected error during initialization.');\n    }\n  }\n\n  public dispose(): void {\n    if (this._messenger) {\n      this._messenger.stopListening();\n    }\n    this.removeWindowResizeHandler();\n  }\n\n  public getCurrentSrcAsync(): Promise<string> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<VizService>(ServiceNames.Viz);\n    return service.getCurrentSrcAsync();\n  }\n\n  public revertAllAsync(): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ToolbarService>(EmbeddingServiceNames.ToolbarService);\n    return service.revertAllAsync();\n  }\n\n  public redoAsync(): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ToolbarService>(EmbeddingServiceNames.ToolbarService);\n    return service.redoAsync();\n  }\n\n  public undoAsync(): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ToolbarService>(EmbeddingServiceNames.ToolbarService);\n    return service.undoAsync();\n  }\n\n  public refreshDataAsync(): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<DataSourceService>(ServiceNames.DataSourceService);\n    return service.refreshAsync();\n  }\n\n  public pauseAutomaticUpdatesAsync(): Promise<void> {\n    if (this._automaticUpdatesArePaused) {\n      return Promise.resolve();\n    }\n    return this.setAutoUpdateAsync(false);\n  }\n\n  public resumeAutomaticUpdatesAsync(): Promise<void> {\n    if (!this._automaticUpdatesArePaused) {\n      return Promise.resolve();\n    }\n    return this.setAutoUpdateAsync(true);\n  }\n\n  public toggleAutomaticUpdatesAsync(): Promise<void> {\n    return this.setAutoUpdateAsync(this._automaticUpdatesArePaused);\n  }\n\n  public exportImageAsync(): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ToolbarService>(EmbeddingServiceNames.ToolbarService);\n    return service.exportImageAsync();\n  }\n\n  public async exportCrosstabAsync(sheetName: string, format: Contract.CrosstabFileFormat): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ExportService>(ServiceNames.Export);\n    await service.exportCrosstabAsync(sheetName, format, this.exportableWorksheetNames, this._workbookImpl.activeSheet.sheetType);\n  }\n\n  public exportDataAsync(sheetName: string, options: Contract.ExportDataOptions = ExportHelpers.DefaultDataOptions): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ExportService>(ServiceNames.Export);\n    return service.exportDataAsync(this.getVisualIdForSheetName(sheetName), options);\n  }\n\n  public async exportPowerPointAsync(sheetNames: Array<string> = []): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ExportService>(ServiceNames.Export);\n    const exportScenarios = this.exportScenariosForPdfAndPowerPoint;\n    if (sheetNames.length === 0) {\n      sheetNames.push(exportScenarios.currentSheetName);\n    }\n    await service.exportPowerPointAsync(sheetNames, exportScenarios);\n  }\n\n  public async exportPDFAsync(\n    sheetNames: Array<string> = [],\n    options: Contract.ExportPDFOptions = ExportHelpers.DefaultPDFOptions,\n  ): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ExportService>(ServiceNames.Export);\n    const exportScenarios = this.exportScenariosForPdfAndPowerPoint;\n    if (sheetNames.length === 0) {\n      sheetNames.push(exportScenarios.currentSheetName);\n    }\n    await service.exportPDFAsync(sheetNames, options, exportScenarios);\n  }\n\n  public displayDialogAsync(dialogType: TableauDialogType): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ToolbarService>(EmbeddingServiceNames.ToolbarService);\n    switch (dialogType) {\n      case TableauDialogType.ExportWorkbook:\n        if (!this.workbookImpl.canDownloadWorkbook) {\n          throw new TableauError(Contract.EmbeddingErrorCodes.DownloadWorkbookNotAllowed, 'Download workbook is not allowed');\n        }\n        return service.displayDownloadWorkbookDialogAsync();\n      case TableauDialogType.ExportPDF:\n        return service.displayExportPdfDialogAsync();\n      case TableauDialogType.ExportPowerPoint:\n        return service.displayExportPowerpointDialogAsync();\n      case TableauDialogType.ExportData:\n        return service.displayExportDataDialogAsync();\n      case TableauDialogType.ExportCrossTab:\n        return service.displayExportCrosstabDialogAsync();\n      case TableauDialogType.Share:\n        return service.displayShareDialogAsync();\n      default:\n        throw new TableauError(Contract.EmbeddingErrorCodes.UnknownDialogType, 'Unknown dialog type');\n    }\n  }\n\n  public setAuthToken(token: string): void {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<AuthService>(ServiceNames.Authentication);\n    service.setAuthToken(token);\n  }\n\n  private setAutoUpdateAsync(state: boolean): Promise<void> {\n    const service = ApiServiceRegistry.get(this.embeddingId).getService<ToolbarService>(EmbeddingServiceNames.ToolbarService);\n    return service.setAutoUpdateAsync(state).then<void>(() => {\n      this._automaticUpdatesArePaused = !state;\n      return;\n    });\n  }\n\n  private isVersionCompatible(platformVersion: VersionNumber | undefined): boolean {\n    // Platform version will be undefined in 2021.4.\n    // Return false when loading a 3.1+ library against 2021.4.\n    if (!platformVersion) {\n      return false;\n    }\n    // If our platform is less than the external library version, return false\n    return VersionLessThan(INTERNAL_CONTRACT_VERSION, platformVersion) || VersionEqualTo(INTERNAL_CONTRACT_VERSION, platformVersion);\n  }\n\n  private updateIframeTitle(bootstrapInfo: EmbeddingBootstrapInfo): void {\n    this._iframe.setAttribute(\n      'title',\n      getLocalizedTitle(navigator.language) + ': ' + bootstrapInfo.workbookName + ': ' + bootstrapInfo.currWorksheetName,\n    );\n  }\n\n  private handleVizInteractiveEvent(bootstrapInfo: EmbeddingBootstrapInfo): void {\n    // Embedding API will currently block all api calls/notifications if there is an incompatible version.\n    if (!this._viz.disableVersionCheck && !this.isVersionCompatible(bootstrapInfo.platformVersion)) {\n      this._messenger.stopListening();\n      throw new TableauError(\n        Contract.EmbeddingErrorCodes.IncompatibleVersionError,\n        'The version of the Embedding library is not compatible with the version of Tableau.' +\n          ' The visualization will load, but the Embedding API methods and events are not available.',\n      );\n    }\n\n    // Update the iframe title so that screen reader users could distinguish between different vizzes embedded on the same page\n    this.updateIframeTitle(bootstrapInfo);\n\n    registerAllSharedServices(this._dispatcher, this.embeddingId);\n    registerAllEmbeddingServices(this._dispatcher, this.embeddingId);\n\n    this._viz.initializeEvents();\n\n    // These are the steps involved. It's critical that this is in order\n    // 1. Create the workbook\n    // 2. Process Custom Views\n    // 3. Send FirstInteractive event\n    // 4. Send CustomViewLoaded event\n    this._workbookImpl = new EmbeddingWorkbookImpl(bootstrapInfo, this.embeddingId);\n    let updatedCustomViews: Array<CustomViewImpl> = [];\n    if (this._customViewsTemp) {\n      updatedCustomViews = this._workbookImpl.processCustomViews(NotificationId.CustomViewsLoaded, this._customViewsTemp);\n    }\n    this._viz.dispatchEvent(new CustomEvent(Contract.EmbeddingTableauEventType.FirstInteractive));\n    if (this._customViewsTemp) {\n      this.sendCustomViewEvents(Contract.EmbeddingTableauEventType.CustomViewLoaded, updatedCustomViews);\n      this._customViewsTemp = null;\n    }\n  }\n\n  private handleVizSizeKnownEvent(model: FirstVizSizeKnownModel): void {\n    const sheetSize = SheetUtils.getSheetSizeFromSizeConstraints(model.sheetSize);\n    this._vizSize = new VizSize(sheetSize, model.chromeHeight);\n    const vizSizeEvent = new FirstVizSizeKnownEvent(this._vizSize);\n    this._viz.dispatchEvent(new CustomEvent(Contract.EmbeddingTableauEventType.FirstVizSizeKnown, { detail: vizSizeEvent }));\n\n    if (this._viz.fixedSize) {\n      return;\n    }\n\n    this.resize();\n    this.addWindowResizeHandler();\n  }\n\n  public resize(): void {\n    const { height, width } = this.calculateLayoutSize();\n\n    if (height === this._vizSize.chromeHeight) {\n      // The chromeHeight is what is calculated for any UI contained within the iframe that\n      // isn't the viz (e.g. toolbar, sheet tabs). If we calculate the height to be only a\n      // big as a chromeHeight, then we are probably too early (e.g. mid-fullscreen change).\n      // Related to defect 570417.\n      return;\n    }\n    this._iframe.style.height = height + 'px';\n    this._iframe.style.width = width + 'px';\n  }\n\n  private calculateLayoutSize(): { height: number; width: number } {\n    const availableSize = this._viz.parentElement ? HtmlElementHelpers.getContentSize(this._viz.parentElement) : { height: 0, width: 0 };\n\n    const { chromeHeight, sheetSize } = this._vizSize;\n\n    let width = 0;\n    let height = 0;\n\n    const minSize = sheetSize.minSize || { height: 0, width: 0 };\n    const maxSize = sheetSize.maxSize || { height: 0, width: 0 };\n\n    // If it's an exact size, use it. The size of the container is disregarded.\n    if (sheetSize.behavior === Contract.SheetSizeBehavior.Exactly) {\n      width = maxSize.width;\n      height = maxSize.height + chromeHeight;\n    } else {\n      let minWidth: number;\n      let maxWidth: number;\n      let minHeight: number;\n      let maxHeight: number;\n\n      switch (sheetSize.behavior) {\n        case Contract.SheetSizeBehavior.Range:\n          // The iframe should obey the range. As the size of the container changes,\n          // the iframe changes size if it can remain within the range\n          minWidth = minSize.width;\n          maxWidth = maxSize.width;\n          minHeight = minSize.height + chromeHeight;\n          maxHeight = maxSize.height + chromeHeight;\n          width = Math.max(minWidth, Math.min(maxWidth, availableSize.width));\n          height = Math.max(minHeight, Math.min(maxHeight, availableSize.height));\n          break;\n\n        case Contract.SheetSizeBehavior.AtLeast:\n          // The iframe should be no smaller than the minimum. As the size of the container changes,\n          // the iframe changes size if it can remain above the minimum size.\n          minWidth = minSize.width;\n          minHeight = minSize.height + chromeHeight;\n          width = Math.max(minWidth, availableSize.width);\n          height = Math.max(minHeight, availableSize.height);\n          break;\n\n        case Contract.SheetSizeBehavior.AtMost:\n          // The iframe should be no larger than the maximum. As the size of the container changes,\n          // the iframe changes size if it can remain below the maximum size\n          maxWidth = maxSize.width;\n          maxHeight = maxSize.height + chromeHeight;\n          width = Math.min(maxWidth, availableSize.width);\n          height = Math.min(maxHeight, availableSize.height);\n          break;\n\n        case Contract.SheetSizeBehavior.Automatic:\n          // the iframe should fill the containing element\n          width = availableSize.width;\n          height = Math.max(availableSize.height, chromeHeight);\n          break;\n\n        default:\n          // We should never get here. The given size behavior is not one we know about. That would be a bug\n          throw new TableauError(\n            Contract.EmbeddingErrorCodes.InvalidSizeBehavior,\n            'Unknown SheetSizeBehavior for viz: ' + sheetSize.behavior,\n          );\n      }\n    }\n    return { height, width };\n  }\n\n  private removeWindowResizeHandler(): void {\n    if (!this._windowResizeHandler) {\n      return;\n    }\n\n    window.removeEventListener(this._resizeEventType, this._windowResizeHandler);\n  }\n\n  private addWindowResizeHandler(): void {\n    if (this._windowResizeHandler) {\n      return;\n    }\n\n    this._windowResizeHandler = this.resize.bind(this);\n    window.addEventListener(this._resizeEventType, this._windowResizeHandler!);\n  }\n\n  private handleToolbarStateEvent(model: ToolbarStateEvent): void {\n    const toolbarStateChangedEvent = new ToolbarStateChangedEvent(model.toolbarState.canRedo, model.toolbarState.canUndo);\n    this._viz.dispatchEvent(new CustomEvent(Contract.EmbeddingTableauEventType.ToolbarStateChanged, { detail: toolbarStateChangedEvent }));\n  }\n\n  private handleTabSwitch(bootstrapInfo: EmbeddingBootstrapInfo): void {\n    // If we didn't receive an interactive event that initializes the workbook, then ignore the tabswitch event\n    if (!this._workbookImpl) {\n      return;\n    }\n    if (!bootstrapInfo.oldSheetName) {\n      return;\n    }\n\n    // Update the iframe title again when the active sheet has changed\n    this.updateIframeTitle(bootstrapInfo);\n\n    const pendingTabSwitchPromise = this._workbookImpl.pendingTabSwitchPromise;\n    this._workbookImpl.updateExistingActiveSheetReferences(bootstrapInfo.currWorksheetName);\n    this._workbookImpl = new EmbeddingWorkbookImpl(bootstrapInfo, this.embeddingId);\n    if (pendingTabSwitchPromise) {\n      pendingTabSwitchPromise.resolve(this._workbookImpl);\n    }\n\n    const tabSwitchedEvent = new TabSwitchedEvent(bootstrapInfo.oldSheetName, bootstrapInfo.currWorksheetName);\n    this._viz.dispatchEvent(new CustomEvent(Contract.EmbeddingTableauEventType.TabSwitched, { detail: tabSwitchedEvent }));\n  }\n\n  private handleCustomViews(customViewsInfo: CustomViewInfoModel): void {\n    // If workbook is not initialized, temporarily store the custom views info in VizImpl\n    if (!this._workbookImpl) {\n      this._customViewsTemp = customViewsInfo;\n    } else {\n      const updatedCustomViews = this._workbookImpl.processCustomViews(NotificationId.CustomViewsLoaded, customViewsInfo);\n\n      const pendingShowCustomViewPromise = this._workbookImpl.pendingShowCustomViewPromise;\n      if (pendingShowCustomViewPromise) {\n        const currentCustomView = updatedCustomViews[0];\n        // currentCustomView can be undefined which means there is no active custom view.\n        // This can happen when requesting the original view, which inactivates any custom view.\n        pendingShowCustomViewPromise.resolve(currentCustomView);\n        this._workbookImpl.clearPendingShowCustomViewPromise();\n      }\n\n      this.sendCustomViewEvents(Contract.EmbeddingTableauEventType.CustomViewLoaded, updatedCustomViews);\n    }\n  }\n\n  private handleCustomViewRemoved(customViewsInfo: CustomViewInfoModel): void {\n    const updatedCustomViews = this._workbookImpl.processCustomViews(NotificationId.CustomViewRemoved, customViewsInfo);\n    this.sendCustomViewEvents(Contract.EmbeddingTableauEventType.CustomViewRemoved, updatedCustomViews);\n  }\n\n  private handleCustomViewSaved(customViewsInfo: CustomViewInfoModel): void {\n    const updatedCustomViews = this._workbookImpl.processCustomViews(NotificationId.CustomViewSaved, customViewsInfo);\n    this.sendCustomViewEvents(Contract.EmbeddingTableauEventType.CustomViewSaved, updatedCustomViews);\n  }\n\n  private handleCustomViewSetDefault(customViewsInfo: CustomViewInfoModel): void {\n    const updatedCustomViews = this._workbookImpl.processCustomViews(NotificationId.CustomViewSetDefault, customViewsInfo);\n    this.sendCustomViewEvents(Contract.EmbeddingTableauEventType.CustomViewSetDefault, updatedCustomViews);\n  }\n\n  private sendCustomViewEvents(tableauEvent: Contract.EmbeddingTableauEventType, updatedCustomViews: Array<CustomViewImpl>) {\n    // Send an event only if there's an updated custom view\n    for (let customView of updatedCustomViews) {\n      const customViewEvent = { customView: new CustomView(customView, this._workbookImpl) } as Contract.CustomViewEvent;\n      this._viz.dispatchEvent(new CustomEvent(tableauEvent, { detail: customViewEvent }));\n    }\n  }\n}\n"]}