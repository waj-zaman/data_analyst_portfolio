{"version":3,"file":"TableauAuthoringViz.js","sourceRoot":"","sources":["../../../../src/EmbeddingApi/Components/TableauAuthoringViz.ts"],"names":[],"mappings":"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","sourcesContent":["import * as Contract from '@tableau/api-external-contract-js';\nimport { NotificationId, WorkbookPublishedAsModel } from '@tableau/api-internal-contract-js';\nimport { AuthoringWorkbook } from '../Models/AuthoringWorkbook';\nimport { EmbeddingUrlMode, createVizUrl } from '../Models/EmbeddingVizUrl';\nimport { AttributeEventType, EventHandlerFn, TableauVizBase } from './TableauVizBase';\n\n/**\n * Represents the entry point for the `<tableau-authoring-viz>` custom HTML element.\n * This class is specifically focused on transferring information between the HTML and\n * the Viz, so it should have as little logic as possible.  Most of the logic should be\n * in {@link VizImpl}.\n */\nexport class TableauAuthoringViz extends TableauVizBase implements Contract.AuthoringViz {\n  // ========================================== Begin Custom Element definition ==========================================\n\n  //#region Reactions\n  public static get observedAttributes(): string[] {\n    // Take caution before adding to this list because for every observed attribute change\n    // we unregister and re-render the viz\n    return [...super.observedAttributes, ...Object.values(Contract.VizAuthoringAttributes)];\n  }\n  //#endregion Reaction\n\n  protected getAttributeEvents(): AttributeEventType[] {\n    return [\n      [Contract.VizSharedAttributes.OnEditInDesktopButtonClicked, Contract.EmbeddingTableauEventType.EditInDesktopButtonClicked],\n      [Contract.VizSharedAttributes.OnFirstInteractive, Contract.EmbeddingTableauEventType.FirstInteractive],\n      [Contract.VizSharedAttributes.OnFirstVizSizeKnown, Contract.EmbeddingTableauEventType.FirstVizSizeKnown],\n      [Contract.VizAuthoringAttributes.OnWorkbookPublished, Contract.EmbeddingTableauEventType.WorkbookPublished],\n      [Contract.VizAuthoringAttributes.OnWorkbookPublishedAs, Contract.EmbeddingTableauEventType.WorkbookPublishedAs],\n      [Contract.VizAuthoringAttributes.OnWorkbookReadyToClose, Contract.EmbeddingTableauEventType.WorkbookReadyToClose],\n      [Contract.VizAttributes.OnReadyToReceiveAuthToken, Contract.EmbeddingTableauEventType.ReadyToReceiveAuthToken],\n    ];\n  }\n\n  protected createFrameUrlWithParams(): URL {\n    const vizqlOptions = this.constructVizqlOptions();\n    const customParams = this.readCustomParamsFromChildren();\n\n    return createVizUrl(\n      this.src,\n      EmbeddingUrlMode.Authoring,\n      vizqlOptions,\n      this._embeddingIdCounter,\n      [] /* filters */,\n      [] /* params */,\n      customParams,\n    );\n  }\n\n  private constructVizqlOptions(): Contract.VizAuthoringSettings {\n    const options: Contract.VizAuthoringSettings = {\n      token: this.token,\n      touchOptimize: this.touchOptimize,\n      hideEditInDesktopButton: this.hideEditInDesktopButton,\n      suppressDefaultEditBehavior: this.suppressDefaultEditBehavior,\n      hideCloseButton: this.hideCloseButton,\n      debug: this.debug,\n      iframeAuth: this.iframeAuth,\n    };\n\n    return options;\n  }\n\n  protected getRegisteredEvents(): EventHandlerFn[] {\n    return super.getRegisteredEvents().concat([\n      [\n        NotificationId.WorkbookPublished,\n        () => true,\n        () => this.dispatchEvent(new CustomEvent(Contract.EmbeddingTableauEventType.WorkbookPublished)),\n      ],\n      [NotificationId.WorkbookPublishedAs, () => true, (model: WorkbookPublishedAsModel) => this.handleWorkbookPublishedAsEvent(model)],\n      [\n        NotificationId.WorkbookReadyToClose,\n        () => true,\n        () => this.dispatchEvent(new CustomEvent(Contract.EmbeddingTableauEventType.WorkbookReadyToClose)),\n      ],\n    ]);\n  }\n\n  private handleWorkbookPublishedAsEvent(model: WorkbookPublishedAsModel): void {\n    const workbookPublishedAsEvent: Contract.WorkbookPublishedAsEvent = {\n      newUrl: model.newUrl,\n    };\n\n    this.dispatchEvent(new CustomEvent(Contract.EmbeddingTableauEventType.WorkbookPublishedAs, { detail: workbookPublishedAsEvent }));\n  }\n\n  //#region Simple Getters / Setters\n  public set hideCloseButton(v: boolean) {\n    if (v) {\n      this.setAttribute(Contract.VizAuthoringAttributes.HideCloseButton, '');\n    } else {\n      this.removeAttribute(Contract.VizAuthoringAttributes.HideCloseButton);\n    }\n  }\n\n  public get hideCloseButton(): boolean {\n    return this.hasAttribute(Contract.VizAuthoringAttributes.HideCloseButton);\n  }\n  //#endregion\n\n  public get workbook(): AuthoringWorkbook {\n    return new AuthoringWorkbook(this.vizImpl.workbookImpl, this.vizImpl.embeddingId);\n  }\n\n  public setAuthToken(token: string): void {\n    this.vizImpl.setAuthToken(token);\n  }\n\n  // ========================================== End Custom Element definition ============================================\n}\n"]}