{"version":3,"file":"TableauPulse.js","sourceRoot":"","sources":["../../../../src/EmbeddingApi/Components/TableauPulse.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  EmbeddingTableauEventType,\n  FilterOptions,\n  FilterParameters,\n  FilterUpdateType,\n  Pulse,\n  PulseAttributes,\n  PulseChildElementAttributes,\n  PulseChildElements,\n  PulseFieldValueArray,\n  PulseFilter,\n  PulseLayout,\n  PulseSettings,\n  PulseTheme,\n  PulseThemeProperty,\n  PulseTimeDimension,\n} from '@tableau/api-external-contract-js';\nimport { ErrorHelpers } from '@tableau/api-shared-js';\nimport { PulseImpl } from '../Impl/PulseImpl';\nimport { createPulseUrl } from '../Models/EmbeddingPulseUrl';\nimport { getSiteIdForPulse } from '../Models/EmbeddingUrlBuilder';\nimport { WebComponentManager } from '../WebComponentManager';\nimport { attributeToEnumKey } from './TableauVizBase';\nimport { TableauAuthResponse, TableauWebComponent } from './TableauWebComponent';\n\ntype AttributeEventType = [PulseAttributes, EmbeddingTableauEventType];\n\n/**\n * Represents the entry point for the `<tableau-pulse>` custom HTML element.\n * This class is specifically focused on transferring information between the HTML and\n * the Tableau Pulse, so it should have as little logic as possible.\n */\nexport class TableauPulse extends TableauWebComponent implements Pulse {\n  private _pulseImpl: PulseImpl;\n\n  // This stores filters added via addFilter()\n  private _preInitFilters: Array<FilterParameters> = [];\n\n  public constructor() {\n    super();\n  }\n\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._preInitFilters = [];\n    if (this._pulseImpl) {\n      this._pulseImpl.dispose();\n    }\n  }\n\n  private getAttributeEvents(): AttributeEventType[] {\n    return [\n      [PulseAttributes.OnFirstInteractive, EmbeddingTableauEventType.FirstInteractive],\n      [PulseAttributes.OnFirstPulseMetricSizeKnown, EmbeddingTableauEventType.FirstPulseMetricSizeKnown],\n      [PulseAttributes.OnPulseUrlError, EmbeddingTableauEventType.PulseError],\n      [PulseAttributes.OnPulseFiltersChanged, EmbeddingTableauEventType.PulseFiltersChanged],\n      [PulseAttributes.OnPulseInsightDiscovered, EmbeddingTableauEventType.PulseInsightDiscovered],\n      [PulseAttributes.OnPulseTimeDimensionChanged, EmbeddingTableauEventType.PulseTimeDimensionChanged],\n      [PulseAttributes.OnPulseUrlChanged, EmbeddingTableauEventType.PulseUrlChanged],\n    ];\n  }\n\n  public static get observedAttributes(): string[] {\n    // Take caution before adding to this list because for every observed attribute change\n    // we unregister and re-render the ask-data webcomponent\n    return [...super.observedAttributes, ...Object.values(PulseAttributes)];\n  }\n\n  protected async updateRenderingIfInitialized(src?: string): Promise<void> {\n    if (!this._initialized) {\n      return;\n    }\n\n    if (this._pulseImpl) {\n      this._pulseImpl.dispose();\n    }\n\n    WebComponentManager.unregisterWebComponent(this._embeddingIdCounter);\n    return this.updateRendering(src);\n  }\n\n  protected async updateRendering(src?: string): Promise<void> {\n    try {\n      this._initialized = true;\n      if (!src) {\n        console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);\n        return;\n      }\n      if (!this.token && !this.isTokenOptional) {\n        console.debug(`A token needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);\n        return;\n      }\n      const authResponse = await this.auth(getSiteIdForPulse(src));\n      if (authResponse === TableauAuthResponse.Failure) {\n        console.debug('Authentication failed.');\n        return;\n      }\n      // Nothing to render if the user hasn't provided a src\n      if (!this.src) {\n        console.debug(`A src needs to be set on the ${this.tagName.toLowerCase()} element. Skipping rendering.`);\n        return;\n      }\n      if (!this.iframe) {\n        console.debug('No iframe available to update the src.');\n        return;\n      }\n      const customParams = this.readCustomParamsFromChildren();\n      this._embeddingIdCounter = WebComponentManager.registerWebComponent(this);\n      this.registerAttributeEvents();\n      const pulseUrl = createPulseUrl(this.src, this.constructOptions(), customParams);\n      const filters = this.readFiltersFromChild().concat(this._preInitFilters);\n      this._pulseImpl = this.createAndInitializePulseImpl(pulseUrl, filters);\n\n      if (this.timeDimension || filters.length) {\n        // If we have a time dimension or filters we hide the iframe until they are done applying to hide the reloads.\n        // The first interactive event will re-show it once it fires.\n        this.iframe.style.visibility = 'hidden';\n      }\n\n      this.iframe.src = pulseUrl.toString();\n      this.raiseIframeSrcUpdatedNotification();\n      return;\n    } catch (e) {\n      console.warn(e);\n    }\n  }\n\n  private createAndInitializePulseImpl(pulseUrl: URL, filters: Array<FilterParameters>): PulseImpl {\n    const pulseImpl = new PulseImpl(this, this.iframe, pulseUrl, this.timeDimension, filters, this._embeddingIdCounter);\n    pulseImpl.initialize();\n    return pulseImpl;\n  }\n\n  private registerAttributeEvents(): void {\n    this.getAttributeEvents().forEach((elem) => {\n      const [attributeEvent, eventType] = elem;\n      this.registerCallback(attributeEvent, eventType);\n    });\n  }\n\n  private readFiltersFromChild(): Array<FilterParameters> {\n    const filters: Array<FilterParameters> = [];\n    [].forEach.call(this.children, (child: HTMLElement) => {\n      if (\n        child.localName === PulseChildElements.PulseFilter &&\n        child.getAttribute(PulseChildElementAttributes.Field) &&\n        child.getAttribute(PulseChildElementAttributes.Value)\n      ) {\n        filters.push({\n          field: child.getAttribute(PulseChildElementAttributes.Field)!,\n          value: child.getAttribute(PulseChildElementAttributes.Value)!,\n        });\n      }\n    });\n    return filters;\n  }\n\n  private readThemeParametersFromChild(): PulseThemeProperty[] {\n    const properties: PulseThemeProperty[] = [];\n    [].forEach.call(this.children, (child: HTMLElement) => {\n      if (child.localName === PulseChildElements.ThemeParameter) {\n        const name = child.getAttribute(PulseChildElementAttributes.Name);\n        const value = child.getAttribute(PulseChildElementAttributes.Value);\n        const type = child.getAttribute(PulseChildElementAttributes.Type);\n        if (name && value) {\n          // type is optional\n          properties.push({\n            name,\n            value,\n            type,\n          });\n        }\n      }\n    });\n\n    return properties;\n  }\n\n  private getThemeString(): string | undefined {\n    const theme = this.themeObj;\n    if (!theme) {\n      return;\n    }\n\n    try {\n      return btoa(JSON.stringify(theme));\n    } catch {\n      return;\n    }\n  }\n\n  private constructOptions(): PulseSettings {\n    const options: PulseSettings = {\n      token: this.token,\n      theme: this.getThemeString(),\n    };\n    if (this.disableExploreFilter) {\n      options.disableExploreFilter = this.disableExploreFilter;\n    }\n    if (this.layout && this.layout !== PulseLayout.Default) {\n      // An empty value implies a default Pulse layout. Don't pass \"default\" value.\n      options.layout = this.layout;\n    }\n    return options;\n  }\n\n  public get disableExploreFilter(): boolean {\n    return this.hasAttribute(PulseAttributes.DisableExploreFilter);\n  }\n\n  public set disableExploreFilter(v: boolean) {\n    if (v) {\n      this.setAttribute(PulseAttributes.DisableExploreFilter, '');\n    } else {\n      this.removeAttribute(PulseAttributes.DisableExploreFilter);\n    }\n  }\n\n  public get layout(): PulseLayout {\n    const layoutKey = attributeToEnumKey(this.getAttribute(PulseAttributes.Layout));\n    const layout = PulseLayout[layoutKey];\n    if (!layout) {\n      return PulseLayout.Default;\n    }\n\n    return layout;\n  }\n\n  public set layout(v: PulseLayout) {\n    if (v) {\n      this.setAttribute(PulseAttributes.Layout, v);\n    } else {\n      this.removeAttribute(PulseAttributes.Layout);\n    }\n  }\n\n  public get themeObj(): PulseTheme | undefined {\n    let theme: PulseTheme | undefined;\n\n    for (const { name, value, type } of this.readThemeParametersFromChild()) {\n      theme = theme ?? {};\n\n      if (type) {\n        theme[type] = theme[type] ?? {};\n        theme[type]![name] = value;\n      } else {\n        theme[name] = value;\n      }\n    }\n\n    return theme;\n  }\n\n  public get timeDimension(): PulseTimeDimension | undefined {\n    const key = this.getAttribute(PulseAttributes.TimeDimension) as PulseTimeDimension | undefined;\n    if (!key) {\n      return;\n    }\n\n    ErrorHelpers.verifyEnumValue<PulseTimeDimension>(key, PulseTimeDimension, 'Contract.PulseTimeDimension');\n    return PulseTimeDimension[key];\n  }\n\n  public set timeDimension(v: PulseTimeDimension | undefined) {\n    if (v) {\n      ErrorHelpers.verifyEnumValue<PulseTimeDimension>(v, PulseTimeDimension, 'Contract.PulseTimeDimension');\n      this.setAttribute(PulseAttributes.TimeDimension, v);\n    } else {\n      this.removeAttribute(PulseAttributes.TimeDimension);\n    }\n  }\n\n  public get isTokenOptional(): boolean {\n    return this.hasAttribute(PulseAttributes.TokenOptional);\n  }\n\n  public set isTokenOptional(v: boolean) {\n    if (v) {\n      this.setAttribute(PulseAttributes.TokenOptional, '');\n    } else {\n      this.removeAttribute(PulseAttributes.TokenOptional);\n    }\n  }\n\n  public addFilter(fieldName: string, value: string): void {\n    this._preInitFilters.push({ field: fieldName, value: value });\n    WebComponentManager.synchronizeRender(this.updateRenderingIfInitialized.bind(this, this.src));\n  }\n\n  public resize(): void {\n    this._pulseImpl.resize();\n  }\n\n  public applyFilterAsync(\n    fieldName: string,\n    values: PulseFieldValueArray,\n    updateType: FilterUpdateType,\n    options: FilterOptions,\n  ): Promise<string> {\n    return this.applyFiltersAsync([{ fieldName, values, updateType, options }]).then((fieldNames) => fieldNames[0]);\n  }\n\n  public applyFiltersAsync(\n    filters: Array<{\n      fieldName: string;\n      values: PulseFieldValueArray;\n      updateType: FilterUpdateType;\n      options: FilterOptions;\n    }>,\n  ): Promise<Array<string>> {\n    return this._pulseImpl.applyFiltersAsync(filters);\n  }\n\n  public getTimeDimensionAsync(): Promise<PulseTimeDimension> {\n    return this._pulseImpl.getTimeDimensionAsync();\n  }\n\n  public applyTimeDimensionAsync(timeDimension: PulseTimeDimension): Promise<void> {\n    return this._pulseImpl.applyTimeDimensionAsync(timeDimension);\n  }\n\n  public getFiltersAsync(): Promise<Array<PulseFilter>> {\n    return this._pulseImpl.getFiltersAsync();\n  }\n\n  public clearFilterAsync(fieldName: string): Promise<string> {\n    return this.clearFiltersAsync([fieldName]).then((fieldNames) => fieldNames[0]);\n  }\n\n  public clearFiltersAsync(fieldNames: Array<string>): Promise<Array<string>> {\n    return this._pulseImpl.clearFiltersAsync(fieldNames);\n  }\n\n  public clearAllFiltersAsync(): Promise<void> {\n    return this._pulseImpl.clearAllFiltersAsync();\n  }\n}\n"]}